<VirtualHost *:80>
  DocumentRoot <%= node['app']['web_dir'] %>/<%= node['app']['site_name'] %>/web

  ServerName foxyssteakbar.dev
  ServerAlias www.foxyssteakbar.dev

  DirectoryIndex website.php

  ErrorLog "<%= node['app']['log_dir'] %>/<%= node['app']['site_name'] %>/error.log"
  CustomLog "<%= node['app']['log_dir'] %>/<%= node['app']['site_name'] %>/access.log" combined

  <Directory <%= node['app']['web_dir'] %>/<%= node['app']['site_name'] %>>
    Require all granted

    Options Indexes FollowSymLinks
    AllowOverride All

    SetEnv SYMFONY_ENV <%= node['app']['mode'] %>
    <% unless @db_user.to_s.strip.empty? %>SetEnv SYMFONY__DATABASE__USER <%= @db_user %><% end %>
    <% unless @db_password.to_s.strip.empty? %>SetEnv SYMFONY__DATABASE__PASSWORD <%= @db_password %><% end %>
  </Directory>

  <IfModule mod_rewrite.c>
    RewriteEngine On

    RewriteCond %{REQUEST_URI}::$1 ^(/.+)/(.*)::2$
    RewriteRule ^(.*) - [E=BASE:%1]

    # RewriteCond %{ENV:REDIRECT_STATUS} ^$
    # RewriteRule ^website.php(/(.*)|$) %{ENV:BASE}/$2 [R=301,L]

    # RewriteCond %{REQUEST_FILENAME} -f
    # RewriteRule .? - [L]

    # Admin Rewrite
    RewriteRule ^admin/ %{ENV:BASE}/admin.php [L]
    RewriteRule ^admin$ %{ENV:BASE}/admin.php [L]

    # RewriteRule .? %{ENV:BASE}/website.php [L]
  </IfModule>

</VirtualHost>
